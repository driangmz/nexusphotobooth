<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NeoBooth AI | iOS Pro Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            /* --- iOS DESIGN SYSTEM TOKENS --- */
            --ios-blue: #007AFF;
            --ios-green: #34C759;
            --ios-indigo: #5856D6;
            --ios-red: #FF3B30;
            --ios-gray: #8E8E93;
            --ios-bg: #000000;
            --ios-surface: rgba(28, 28, 30, 0.65);
            --ios-surface-light: rgba(44, 44, 46, 0.75);
            --ios-glass: blur(25px) saturate(180%);
            --ios-radius-lg: 32px;
            --ios-radius-md: 18px;
            --ios-radius-sm: 10px;
            --font-stack: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; font-family: var(--font-stack); }
        
        body {
            background-color: var(--ios-bg);
            color: white;
            margin: 0;
            height: 100dvh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ADAPTIVE LAYOUT ENGINE --- */
        .app-container {
            display: grid;
            height: 100%;
            width: 100%;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
        }

        /* DESKTOP (Pro Studio Layout) */
        @media (min-width: 1025px) {
            .app-container {
                grid-template-columns: 320px 1fr 360px;
                grid-template-rows: 60px 1fr 60px;
                gap: 20px;
                padding: 20px;
                background: radial-gradient(circle at center, #1c1c1e 0%, #000 100%);
            }
            .header { grid-column: 1 / -1; }
            .sidebar-left { grid-row: 2; }
            .stage-area { grid-row: 2; }
            .sidebar-right { grid-row: 2; }
            .footer { grid-column: 1 / -1; }
        }

        /* TABLET (Hybrid) */
        @media (max-width: 1024px) and (min-width: 769px) {
            .app-container {
                grid-template-columns: 280px 1fr;
                grid-template-rows: 60px 1fr auto;
                padding: 15px;
            }
            .sidebar-right { display: none; /* Collapsed into bottom sheet logic for tablet */ }
        }

        /* MOBILE (iOS Camera App Style) */
        @media (max-width: 768px) {
            .app-container {
                display: flex;
                flex-direction: column;
                padding: 0;
                background: #000;
            }
            
            /* Reorder for Thumb Reachability */
            .header { order: 1; padding: 10px 20px; background: transparent !important; border: none !important; z-index: 10; pointer-events: none; }
            .header * { pointer-events: auto; }
            
            .stage-area { 
                order: 2; 
                flex-grow: 1; 
                margin: 10px; 
                border-radius: var(--ios-radius-lg); 
                overflow: hidden;
            }
            
            .sidebar-left { display: none; } /* Hidden, features moved to bottom sheet */
            .sidebar-right { display: none; }
            
            .mobile-controls {
                order: 3;
                background: black;
                padding-bottom: calc(20px + var(--safe-area-bottom));
                display: flex !important;
                flex-direction: column;
                gap: 15px;
            }
        }

        /* --- GLASS PANELS (Desktop/Tablet) --- */
        .glass-panel {
            background: var(--ios-surface);
            backdrop-filter: var(--ios-glass);
            -webkit-backdrop-filter: var(--ios-glass);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: var(--ios-radius-md);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        /* --- HEADER --- */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 600; letter-spacing: -0.5px;
        }
        .brand { display: flex; align-items: center; gap: 8px; font-size: 1.1rem; }
        .live-badge { 
            background: rgba(255, 59, 48, 0.2); color: var(--ios-red); 
            padding: 4px 10px; border-radius: 100px; font-size: 0.7rem; font-weight: 700; 
            display: flex; align-items: center; gap: 6px;
        }
        .live-badge::before { content:''; width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: blink 2s infinite; }

        /* --- STAGE & VIEWPORT --- */
        .stage-area {
            position: relative;
            background: #000;
            border-radius: var(--ios-radius-md);
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
        }
        .viewport {
            width: 100%; height: 100%; object-fit: contain;
            position: relative;
        }
        video, canvas { 
            width: 100%; height: 100%; object-fit: contain; 
            position: absolute; top:0; left:0; 
            transform: scaleX(-1); /* Mirror by default */
        }

        /* --- AUTHENTIC CAPTION/SHUTTER BUTTON --- */
        .shutter-ring {
            width: 72px; height: 72px;
            border-radius: 50%;
            border: 4px solid white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            margin: 0 auto; /* Center in container */
        }
        .shutter-inner {
            width: 54px; height: 54px;
            background: white;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        .shutter-ring:active { transform: scale(0.95); opacity: 0.8; }
        .shutter-ring:active .shutter-inner { transform: scale(0.9); }
        
        /* Burst Mode Look */
        .shutter-ring.burst .shutter-inner { background: var(--ios-bg); border: 2px solid white; }

        /* --- IOS CONTROLS --- */
        .ios-slider {
            -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0;
        }
        .ios-slider::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px;
        }
        .ios-slider::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.3); margin-top: -8px;
        }

        .ios-segment {
            display: flex; background: rgba(118, 118, 128, 0.24); 
            padding: 2px; border-radius: 8px; width: 100%;
        }
        .segment-opt {
            flex: 1; text-align: center; padding: 6px; font-size: 13px; font-weight: 500;
            border-radius: 6px; cursor: pointer; color: white; transition: 0.2s;
        }
        .segment-opt.active {
            background: #636366; color: white; box-shadow: 0 3px 8px rgba(0,0,0,0.12);
        }
        /* Light Theme override for segments */
        @media (prefers-color-scheme: light) {
            .segment-opt.active { background: white; color: black; }
        }

        /* --- MOBILE BOTTOM BAR --- */
        .mobile-controls { display: none; }
        .mode-scroller {
            display: flex; gap: 20px; overflow-x: auto; padding: 10px 50% 10px 50%;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .mode-scroller::-webkit-scrollbar { display: none; }
        .mode-item {
            font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
            color: rgba(255,255,255,0.5); white-space: nowrap; scroll-snap-align: center;
            transition: color 0.2s, transform 0.2s; cursor: pointer;
        }
        .mode-item.active { color: #FFD60A; transform: scale(1.1); text-shadow: 0 0 10px rgba(255, 214, 10, 0.5); }

        .toolbar {
            display: flex; justify-content: space-around; align-items: center; padding: 0 20px;
        }
        .tool-icon {
            width: 44px; height: 44px; background: rgba(255,255,255,0.1); 
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; backdrop-filter: blur(10px); cursor: pointer;
        }

        /* --- HUD & OVERLAYS --- */
        .dynamic-island {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            background: black; color: white; padding: 0 15px; height: 35px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.8rem;
            opacity: 0; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); pointer-events: none; z-index: 100;
        }
        .dynamic-island.show { opacity: 1; width: auto; }

        .grid-lines {
            position: absolute; inset: 0; pointer-events: none; opacity: 0.3; display: none;
            background-image: linear-gradient(to right, #fff 1px, transparent 1px), linear-gradient(to bottom, #fff 1px, transparent 1px);
            background-size: 33.33% 33.33%;
        }
        .grid-lines.active { display: block; }

        /* --- BOTTOM SHEET (For Mobile Tools) --- */
        .bottom-sheet {
            position: fixed; bottom: 0; left: 0; width: 100%; background: #1c1c1e;
            border-radius: 24px 24px 0 0; padding: 20px; transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); z-index: 2000;
            max-height: 50vh; overflow-y: auto;
        }
        .bottom-sheet.open { transform: translateY(0); }
        .sheet-handle { width: 40px; height: 5px; background: rgba(255,255,255,0.2); border-radius: 3px; margin: 0 auto 20px auto; }

        /* --- BADGE TOAST --- */
        .toast {
            position: fixed; top: 60px; left: 20px; background: rgba(255,255,255,0.9);
            color: black; padding: 10px 16px; border-radius: 12px; font-size: 0.9rem; font-weight: 600;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); transform: translateX(-150%);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 3000;
            display: flex; align-items: center; gap: 8px;
        }
        .toast.show { transform: translateX(0); }

        @keyframes blink { 50% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div class="dynamic-island" id="island">
        <span id="islandIcon">üì∏</span> <span id="islandText">Processing...</span>
    </div>

    <div class="toast" id="toast">
        <span>üèÜ</span> <span id="toastMsg">Achievement Unlocked!</span>
    </div>

    <div class="app-container">
        
        <div class="header">
            <div class="brand">
                <span style="font-weight:900">NeoBooth</span><span style="opacity:0.6; font-weight:400">PRO</span>
            </div>
            <div class="live-badge">LIVE 4K</div>
        </div>

        <aside class="glass-panel sidebar-left">
            <h3>Configuration</h3>
            
            <div style="font-size:0.75rem; color:gray; margin-bottom:5px;">LENS</div>
            <div class="ios-segment">
                <div class="segment-opt active" onclick="setZoom(1)">1x</div>
                <div class="segment-opt" onclick="setZoom(2)">2x</div>
                <div class="segment-opt" onclick="setZoom(0.5)">0.5x</div>
            </div>

            <div style="font-size:0.75rem; color:gray; margin-bottom:5px; margin-top:15px;">ASPECT RATIO</div>
            <div class="ios-segment">
                <div class="segment-opt" onclick="setAspect('9/16')">9:16</div>
                <div class="segment-opt active" onclick="setAspect('16/9')">16:9</div>
                <div class="segment-opt" onclick="setAspect('1/1')">1:1</div>
            </div>

            <div style="margin-top:auto;">
                <div style="font-size:0.75rem; color:gray; margin-bottom:5px;">ASSISTIVE</div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <button class="ios-segment" style="justify-content:center; padding:10px; font-weight:600;" onclick="toggleGrid()"># Grid</button>
                    <button class="ios-segment" style="justify-content:center; padding:10px; font-weight:600;" onclick="toggleMirror()">‚Üî Mirror</button>
                </div>
            </div>
        </aside>

        <main class="stage-area">
            <div class="viewport" id="viewport">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
                <div class="grid-lines" id="gridLines"></div>
                
                <div id="countdown" style="position:absolute; inset:0; display:none; align-items:center; justify-content:center; font-size:10rem; font-weight:800; color:white; text-shadow:0 2px 10px rgba(0,0,0,0.5);">3</div>
            </div>
        </main>

        <aside class="glass-panel sidebar-right">
            <h3>Creative Lab</h3>
            
            <div>
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                    <span>Exposure</span> <span>0.0</span>
                </div>
                <input type="range" class="ios-slider" min="50" max="150" value="100" oninput="updateFilter('brightness', this.value)">
            </div>
            
            <div>
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                    <span>Contrast</span> <span>0.0</span>
                </div>
                <input type="range" class="ios-slider" min="50" max="150" value="100" oninput="updateFilter('contrast', this.value)">
            </div>

            <div style="margin-top:20px;">
                <div style="font-size:0.75rem; color:gray; margin-bottom:10px;">PRESETS</div>
                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px;">
                    <div style="aspect-ratio:1; background:#333; border-radius:8px; cursor:pointer;" onclick="setPreset('noir')"></div>
                    <div style="aspect-ratio:1; background:#555; border-radius:8px; cursor:pointer;" onclick="setPreset('vivid')"></div>
                    <div style="aspect-ratio:1; background:#777; border-radius:8px; cursor:pointer;" onclick="setPreset('warm')"></div>
                </div>
            </div>
        </aside>

        <div class="mobile-controls">
            <div class="mode-scroller">
                <div class="mode-item" onclick="setMode('pano')">PANO</div>
                <div class="mode-item" onclick="setMode('square')">SQUARE</div>
                <div class="mode-item active" onclick="setMode('photo')">PHOTO</div>
                <div class="mode-item" onclick="setMode('video')">VIDEO</div>
                <div class="mode-item" onclick="setMode('slow')">SLO-MO</div>
            </div>

            <div class="toolbar">
                <div class="tool-icon" onclick="openSheet('gallery')">üñºÔ∏è</div>
                
                <div class="shutter-ring" onclick="capture()">
                    <div class="shutter-inner"></div>
                </div>
                
                <div class="tool-icon" onclick="toggleCamera()">üîÑ</div>
            </div>
        </div>

        <div class="glass-panel footer" style="flex-direction:row; align-items:center; justify-content:space-between; height:auto; padding:10px 20px;">
            <div style="font-size:0.8rem; opacity:0.6;">ISO 100 ‚Ä¢ f/2.8 ‚Ä¢ 1/60s</div>
            <button class="shutter-ring" style="width:50px; height:50px; border-width:3px;" onclick="capture()">
                <div class="shutter-inner" style="width:38px; height:38px;"></div>
            </button>
            <div style="font-size:0.8rem; opacity:0.6;">RAW ‚Ä¢ 12MP</div>
        </div>

    </div>

    <div class="bottom-sheet" id="settingsSheet">
        <div class="sheet-handle" onclick="closeSheet()"></div>
        <h3 style="text-align:center; margin-bottom:20px;">Studio Tools</h3>
        
        <div style="margin-bottom:20px;">
            <label style="font-size:0.8rem; opacity:0.7;">FILTERS</label>
            <div class="ios-segment" style="margin-top:10px;">
                <div class="segment-opt" onclick="setPreset('noir')">Noir</div>
                <div class="segment-opt active" onclick="setPreset('std')">Std</div>
                <div class="segment-opt" onclick="setPreset('vivid')">Vivid</div>
            </div>
        </div>

        <div style="margin-bottom:20px;">
            <label style="font-size:0.8rem; opacity:0.7;">LAYOUT</label>
            <div class="ios-segment" style="margin-top:10px;">
                <div class="segment-opt" onclick="setLayout('grid')">Grid</div>
                <div class="segment-opt active" onclick="setLayout('single')">Full</div>
                <div class="segment-opt" onclick="setLayout('strip')">Strip</div>
            </div>
        </div>

        <button class="btn" style="width:100%; background:var(--ios-blue); color:white;" onclick="closeSheet()">Done</button>
    </div>

    <script>
        // --- CORE LOGIC ---
        const state = {
            mode: 'photo',
            zoom: 1,
            aspect: 1.77, // 16:9
            filters: { brightness: 100, contrast: 100 },
            isRecording: false
        };

        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // --- INIT CAMERA ---
        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1920 }, 
                        height: { ideal: 1080 },
                        facingMode: "user"
                    } 
                });
                video.srcObject = stream;
                showIsland("Camera Ready", "üì∏");
            } catch (e) {
                showIsland("Camera Error", "‚ö†Ô∏è");
            }
        }
        initCamera();

        // --- CAPTURE & ANIMATION ---
        function capture() {
            // Haptic Visual
            const btn = document.querySelector('.shutter-inner');
            btn.style.transform = "scale(0.85)";
            setTimeout(() => btn.style.transform = "scale(1)", 100);

            // Shutter Flash
            const flash = document.createElement('div');
            flash.style.cssText = "position:fixed; inset:0; background:black; z-index:9999; animation:flash 0.3s ease-out;";
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 300);

            // Logic
            if(state.mode === 'photo') takePhoto();
            else if(state.mode === 'burst') startBurst();
        }

        function takePhoto() {
            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            
            // Apply Transforms (Mirror)
            ctx.translate(canvas.width, 0); 
            ctx.scale(-1, 1);
            
            // Apply Filters (Canvas Level)
            ctx.filter = `brightness(${state.filters.brightness}%) contrast(${state.filters.contrast}%)`;
            
            ctx.drawImage(video, 0, 0);
            
            // Mock Save
            showIsland("Saved to Photos", "‚úÖ");
            showToast("Memory Saved");
        }

        // --- UI ADAPTATION ---
        function setZoom(lvl) {
            state.zoom = lvl;
            video.style.transform = `scaleX(-1) scale(${lvl})`; // Keep mirror + zoom
            document.querySelectorAll('.segment-opt').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setAspect(ratio) {
            const vp = document.querySelector('.stage-area');
            if(ratio === '1/1') vp.style.aspectRatio = '1/1';
            else if(ratio === '9/16') vp.style.aspectRatio = '9/16';
            else vp.style.aspectRatio = '16/9';
        }

        function toggleGrid() {
            document.getElementById('gridLines').classList.toggle('active');
        }

        function toggleMirror() {
            const current = video.style.transform;
            video.style.transform = current.includes('scaleX(-1)') ? 'scaleX(1)' : 'scaleX(-1)';
        }

        // --- MOBILE SHEETS ---
        function openSheet() {
            document.getElementById('settingsSheet').classList.add('open');
        }
        function closeSheet() {
            document.getElementById('settingsSheet').classList.remove('open');
        }

        // --- NOTIFICATIONS ---
        function showIsland(text, icon) {
            const el = document.getElementById('island');
            document.getElementById('islandIcon').innerText = icon;
            document.getElementById('islandText').innerText = text;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 2500);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        // --- MODE SWITCHER (Mobile) ---
        function setMode(m) {
            state.mode = m;
            document.querySelectorAll('.mode-item').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            
            // Scroll to center active item (Simplified)
            event.target.scrollIntoView({ behavior: 'smooth', inline: 'center' });
        }

        function updateFilter(type, val) {
            state.filters[type] = val;
            video.style.filter = `brightness(${state.filters.brightness}%) contrast(${state.filters.contrast}%)`;
        }

        /* Inject Keyframes via JS for simplicity in single file */
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes flash { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>
