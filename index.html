<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio X: Design Booth</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Permanent+Marker&family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #121212;
            --panel: #1e1e1e;
            --text: #ffffff;
            --accent: #8b5cf6; /* Violet */
            --accent-gradient: linear-gradient(135deg, #8b5cf6 0%, #d946ef 100%);
            --border: #333;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LEFT: STAGE --- */
        .stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .viewport-wrapper {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 4px solid #333;
            max-width: 100%;
            max-height: 80vh;
        }

        video {
            display: block;
            transform: scaleX(-1);
            max-width: 100%;
            height: auto;
        }

        /* LIVE OVERLAYS (CSS Mirrors of Canvas Logic) */
        .overlay-frame {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 10;
            border: 0px solid white; /* Dynamic */
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .overlay-text {
            margin-bottom: 20px;
            font-size: 2rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 12;
            text-align: center;
        }

        .sticker-layer {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 4rem;
            z-index: 11;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
            display: none;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .countdown {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10rem;
            font-weight: 900;
            color: white;
            z-index: 20;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.8);
            opacity: 0;
            pointer-events: none;
        }

        /* --- RIGHT: DESIGN STUDIO --- */
        .studio-panel {
            width: 380px;
            background: var(--panel);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .header {
            padding: 20px;
            background: linear-gradient(to right, #1e1e1e, #2a2a2a);
            border-bottom: 1px solid var(--border);
        }
        .header h1 { margin: 0; font-size: 1.2rem; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .controls { padding: 20px; display: flex; flex-direction: column; gap: 25px; }

        .control-section h3 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Template Grid */
        .template-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .template-card {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            text-align: center;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        .template-card:hover { background: #333; }
        .template-card.active { border-color: #d946ef; background: #3a1c3a; }

        /* Inputs */
        input[type="text"] {
            width: 100%;
            background: #2a2a2a;
            border: 1px solid #444;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-family: inherit;
        }

        /* Stickers */
        .sticker-bar {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .sticker-btn {
            font-size: 1.5rem;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 5px 10px;
            cursor: pointer;
            min-width: 50px;
        }
        .sticker-btn.active { border-color: var(--accent); background: #3a1c3a; }

        /* Big Button */
        .snap-btn {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            transition: transform 0.1s;
            margin-top: 10px;
        }
        .snap-btn:active { transform: scale(0.98); }

        /* Gallery */
        .gallery {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            border-top: 1px solid var(--border);
        }
        .gallery img {
            width: 100%;
            border-radius: 4px;
            border: 1px solid #444;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .gallery img:hover { transform: scale(1.05); z-index: 5; }

        canvas { display: none; }
    </style>
</head>
<body>

    <div class="stage">
        <div class="viewport-wrapper" id="viewport">
            <video id="video" autoplay playsinline muted></video>
            
            <div id="overlayFrame" class="overlay-frame">
                <div id="overlayText" class="overlay-text"></div>
            </div>
            <div id="activeSticker" class="sticker-layer"></div>
            <div id="countdown" class="countdown">3</div>
        </div>
        <p style="margin-top:10px; font-size: 0.8rem; color: #666;">High-Res Canvas Rendering Active</p>
    </div>

    <div class="studio-panel">
        <div class="header">
            <h1>âœ¨ Studio X Design</h1>
        </div>

        <div class="controls">
            
            <div class="control-section">
                <h3>1. Choose Template</h3>
                <div class="template-grid">
                    <div class="template-card active" onclick="setTemplate('none')">No Frame</div>
                    <div class="template-card" onclick="setTemplate('polaroid')">Polaroid</div>
                    <div class="template-card" onclick="setTemplate('magazine')">Vogue</div>
                    <div class="template-card" onclick="setTemplate('film')">Film Strip</div>
                </div>
            </div>

            <div class="control-section">
                <h3>2. Add Caption</h3>
                <input type="text" id="captionInput" placeholder="e.g. Summer 2026" oninput="updateText(this.value)">
            </div>

            <div class="control-section">
                <h3>3. Add Sticker</h3>
                <div class="sticker-bar">
                    <button class="sticker-btn" onclick="toggleSticker('none')">ðŸš«</button>
                    <button class="sticker-btn" onclick="toggleSticker('âœ¨')">âœ¨</button>
                    <button class="sticker-btn" onclick="toggleSticker('ðŸ’–')">ðŸ’–</button>
                    <button class="sticker-btn" onclick="toggleSticker('ðŸ”¥')">ðŸ”¥</button>
                    <button class="sticker-btn" onclick="toggleSticker('ðŸ‘‘')">ðŸ‘‘</button>
                </div>
            </div>

            <button class="snap-btn" onclick="takePhoto()">CAPTURE DESIGN</button>
        </div>

        <div class="gallery" id="gallery"></div>
    </div>

    <canvas id="canvas"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const overlayFrame = document.getElementById('overlayFrame');
    const overlayText = document.getElementById('overlayText');
    const activeSticker = document.getElementById('activeSticker');
    const countdownEl = document.getElementById('countdown');

    // State
    let config = {
        template: 'none', // none, polaroid, magazine, film
        text: '',
        sticker: 'none'
    };

    // 1. INIT CAMERA
    async function init() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { width: {ideal: 1280}, height: {ideal: 720}, facingMode: 'user' },
                audio: false
            });
            video.srcObject = stream;
        } catch(e) {
            alert("Camera error. Please run on HTTPS or Localhost.");
        }
    }

    // 2. LIVE PREVIEW UPDATES
    function setTemplate(name) {
        config.template = name;
        
        // Reset CSS
        overlayFrame.style.border = 'none';
        overlayFrame.style.background = 'transparent';
        overlayText.style.fontFamily = 'Poppins';
        overlayText.style.color = 'white';
        overlayText.style.bottom = '20px';

        // Update UI Highlights
        document.querySelectorAll('.template-card').forEach(c => c.classList.remove('active'));
        event.target.classList.add('active');

        // Apply CSS Preview Styles
        if (name === 'polaroid') {
            overlayFrame.style.border = '20px solid white';
            overlayFrame.style.borderBottom = '80px solid white';
            overlayText.style.color = '#333';
            overlayText.style.fontFamily = 'Permanent Marker';
            overlayText.style.transform = 'translateY(40px)'; // Move into the white space
        } 
        else if (name === 'magazine') {
            overlayFrame.style.border = '2px solid rgba(255,255,255,0.5)';
            overlayText.style.fontFamily = 'Playfair Display';
            overlayText.style.fontSize = '3rem';
            overlayText.style.fontStyle = 'italic';
            overlayText.style.top = '20px'; // Top title
            overlayText.style.bottom = 'auto';
        }
    }

    function updateText(val) {
        config.text = val;
        overlayText.innerText = val;
    }

    function toggleSticker(emoji) {
        config.sticker = emoji;
        if (emoji === 'none') {
            activeSticker.style.display = 'none';
        } else {
            activeSticker.innerText = emoji;
            activeSticker.style.display = 'block';
        }
    }

    // 3. CAPTURE & RENDER ENGINE
    async function takePhoto() {
        // Countdown
        for(let i=3; i>0; i--) {
            countdownEl.innerText = i;
            countdownEl.style.opacity = 1;
            await new Promise(r => setTimeout(r, 800));
        }
        countdownEl.style.opacity = 0;

        // --- RENDER PIPELINE ---
        const w = video.videoWidth;
        const h = video.videoHeight;
        
        // 1. Setup Canvas
        canvas.width = w;
        canvas.height = h;

        // 2. Draw Video (Mirrored)
        ctx.save();
        ctx.translate(w, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0, w, h);
        ctx.restore();

        // 3. Apply Templates (Canvas Drawing API)
        if (config.template === 'polaroid') {
            const borderSize = 40;
            const bottomSize = 160;
            
            // We need to shrink the video to fit inside or draw over? 
            // Let's draw a white frame Over the video
            ctx.strokeStyle = "white";
            ctx.lineWidth = borderSize * 2; // Stroke is centered
            ctx.strokeRect(0, 0, w, h);
            
            // Bottom bar
            ctx.fillStyle = "white";
            ctx.fillRect(0, h - bottomSize, w, bottomSize);
            
            // Text
            if (config.text) {
                ctx.fillStyle = "#222";
                ctx.font = "60px 'Permanent Marker', cursive";
                ctx.textAlign = "center";
                ctx.fillText(config.text, w/2, h - 60);
            }
        } 
        else if (config.template === 'magazine') {
            // Dark gradient at bottom
            const grad = ctx.createLinearGradient(0, h/2, 0, h);
            grad.addColorStop(0, "transparent");
            grad.addColorStop(1, "rgba(0,0,0,0.6)");
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, w, h);

            // Vogue Style Text
            if (config.text) {
                ctx.fillStyle = "white";
                ctx.font = "italic bold 100px 'Playfair Display', serif";
                ctx.textAlign = "center";
                ctx.shadowColor = "rgba(0,0,0,0.5)";
                ctx.shadowBlur = 20;
                ctx.fillText(config.text, w/2, 150);
            }
            
            // Border
            ctx.strokeStyle = "rgba(255,255,255,0.8)";
            ctx.lineWidth = 4;
            ctx.strokeRect(30, 30, w-60, h-60);
        }
        else if (config.template === 'film') {
            // Film Perforations
            ctx.fillStyle = "black";
            const stripW = 60;
            ctx.fillRect(0, 0, stripW, h); // Left
            ctx.fillRect(w-stripW, 0, stripW, h); // Right
            
            // Holes
            ctx.fillStyle = "white";
            for(let y=20; y<h; y+=80) {
                ctx.fillRect(15, y, 30, 40);
                ctx.fillRect(w-45, y, 30, 40);
            }

            if (config.text) {
                ctx.fillStyle = "white";
                ctx.font = "40px 'Courier New', monospace";
                ctx.textAlign = "right";
                ctx.fillText(config.text, w - 80, h - 30);
            }
        }
        else {
            // Normal Text placement
            if (config.text) {
                ctx.fillStyle = "white";
                ctx.font = "bold 60px 'Poppins', sans-serif";
                ctx.textAlign = "center";
                ctx.shadowColor = "black";
                ctx.shadowBlur = 10;
                ctx.fillText(config.text, w/2, h - 50);
            }
        }

        // 4. Draw Sticker
        if (config.sticker !== 'none') {
            ctx.font = "150px serif";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            // Hardcoded position: Top Right
            ctx.fillText(config.sticker, w - 120, 120);
        }

        // 5. Output
        const finalImage = canvas.toDataURL('image/png');
        addToGallery(finalImage);
    }

    function addToGallery(src) {
        const img = document.createElement('img');
        img.src = src;
        img.onclick = () => {
            const a = document.createElement('a');
            a.href = src;
            a.download = `DesignBooth_${Date.now()}.png`;
            a.click();
        };
        document.getElementById('gallery').prepend(img);
    }

    window.onload = init;

</script>
</body>
</html>
